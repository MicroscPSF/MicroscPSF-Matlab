% Fig.2 One example of approximation of function $f(\rho, \theta)$. (a) The real part of $f(\rho, \theta)$ and its approximation.
% The relative error is $5.99\times 10^{-5}$. (b) The imaginary part of $f(\rho, \theta)$ and its approximation.
% The relative error is $3.28\times 10^{-6}$.

%   Copyright © Jizhou Li, 2016, The Chinese University of Hong Kong
%   Update date: 28 Aug, 2016

clear; clc;
% Bessel function approximation
N = 20;
L = 100;
Rho = linspace(0,0.95,L);
OPD = @(x)15*sqrt(1-(x/2)^2)+1.5*sqrt(1-(x/2)^2);
PhiReal = @(x)cos(10*OPD(x));
PhiImag = @(x)sin(10*OPD(x));

bessel0zeros = [2.40482555769577,5.52007811028631,8.65372791291101,11.7915344390143,14.9309177084878,18.0710639679109,21.2116366298793,24.3524715307493,27.4934791320403,30.6346064684320,33.7758202135736,36.9170983536640,40.0584257646282,43.1997917131767,46.3411883716618,49.4826098973978,52.6240518411150,55.7655107550200,58.9069839260809,62.0484691902272,65.1899648002069,68.3314693298568,71.4729816035937,74.6145006437018,77.7560256303881,80.8975558711376,84.0390907769382,87.1806298436412,90.3221726372105,93.4637187819448,96.6052679509963,99.7468198586806,102.888374254195,106.029930916452,109.171489649805,112.313050280495,115.454612653667,118.596176630873,121.737742087951,124.879308913233,128.020877006008,131.162446275214,134.304016638305,137.445588020284,140.587160352854,143.728733573690,146.870307625797,150.011882456955,153.153458019228,156.295034268534,159.436611164263,162.578188668947,165.719766747955,168.861345369236,172.002924503078,175.144504121903,178.286084200074,181.427664713731,184.569245640639,187.710826960049,190.852408652582,193.993990700109,197.135573085661,200.277155793332,203.418738808199,206.560322116244,209.701905704294,212.843489559950,215.985073671534,219.126658028041,222.268242619084,225.409827434859,228.551412466099,231.692997704039,234.834583140383,237.976168767276,241.117754577268,244.259340563296,247.400926718653,250.542513036970,253.684099512193,256.825686138564,259.967272910605,263.108859823096,266.250446871066,269.392034049776,272.533621354705,275.675208781537,278.816796326153,281.958383984615,285.099971753160,288.241559628188,291.383147606255,294.524735684065,297.666323858459,300.807912126411,303.949500485021,307.091088931505,310.232677463195,313.374266077528,316.515854772043,319.657443544376,322.799032392256,325.940621313497,329.082210305999,332.223799367740,335.365388496774,338.506977691229,341.648566949298,344.790156269244,347.931745649390,351.073335088121,354.214924583876,357.356514135154,360.498103740501,363.639693398517,366.781283107848,369.922872867188,373.064462675271,376.206052530879,379.347642432829,382.489232379979,385.630822371226,388.772412405501,391.914002481767,395.055592599025,398.197182756303,401.338772952662,404.480363187190,407.621953459007,410.763543767255,413.905134111106,417.046724489755,420.188314902422,423.329905348348,426.471495826800,429.613086337063,432.754676878445,435.896267450272,439.037858051892,442.179448682670,445.321039341988,448.462630029246,451.604220743862,454.745811485268,457.887402252913,461.028993046260,464.170583864789,467.312174707990,470.453765575370,473.595356466447,476.736947380753,479.878538317832,483.020129277240,486.161720258543,489.303311261319,492.444902285159,495.586493329661,498.728084394435,501.869675479099,505.011266583284,508.152857706627,511.294448848774,514.436040009382,517.577631188113,520.719222384641,523.860813598645,527.002404829812,530.143996077837,533.285587342422,536.427178623277,539.568769920117,542.710361232665,545.851952560648,548.993543903804,552.135135261871,555.276726634598,558.418318021737,561.559909423046,564.701500838288,567.843092267233,570.984683709653,574.126275165329,577.267866634042,580.409458115583,583.551049609743,586.692641116320,589.834232635116,592.975824165935,596.117415708589,599.259007262891,602.400598828659,605.542190405714,608.683781993881,611.825373592990,614.966965202873,618.108556823365,621.250148454305,624.391740095537,627.533331746904,630.674923408256,633.816515079445,636.958106760324,640.099698450751,643.241290150587,646.382881859693,649.524473577936,652.666065305183,655.807657041305,658.949248786176,662.090840539670,665.232432301666,668.374024072043,671.515615850684,674.657207637474,677.798799432298,680.940391235047,684.081983045611,687.223574863882,690.365166689756,693.506758523129,696.648350363899,699.789942211967,702.931534067236,706.073125929609,709.214717798991,712.356309675290,715.497901558415,718.639493448276,721.781085344786,724.922677247857,728.064269157406,731.205861073348,734.347452995601,737.489044924085,740.630636858720,743.772228799429,746.913820746135,750.055412698762,753.197004657237,756.338596621487,759.480188591439,762.621780567024,765.763372548171,768.904964534814,772.046556526885,775.188148524317,778.329740527046,781.471332535009,784.612924548141,787.754516566382,790.896108589670,794.037700617946,797.179292651150,800.320884689225,803.462476732114,806.604068779759,809.745660832106,812.887252889101,816.028844950689,819.170437016818,822.312029087435,825.453621162490,828.595213241932,831.736805325711,834.878397413779,838.019989506087,841.161581602587,844.303173703233,847.444765807978,850.586357916778,853.727950029588,856.869542146362,860.011134267059,863.152726391635,866.294318520048,869.435910652255,872.577502788218,875.719094927894,878.860687071244,882.002279218229,885.143871368811,888.285463522950,891.427055680609,894.568647841752,897.710240006342,900.851832174342,903.993424345717,907.135016520432,910.276608698453,913.418200879745,916.559793064274,919.701385252009,922.842977442914,925.984569636960,929.126161834113,932.267754034342,935.409346237617,938.550938443906,941.692530653180,944.834122865408,947.975715080562,951.117307298612,954.258899519530,957.400491743287,960.542083969856,963.683676199209,966.825268431319,969.966860666160,973.108452903704,976.250045143926,979.391637386799,982.533229632300,985.674821880401,988.816414131079,991.958006384309,995.099598640068,998.241190898330,1001.38278315907,1004.52437542227,1007.66596768791,1010.80755995595,1013.94915222639,1017.09074449919,1020.23233677434,1023.37392905181,1026.51552133158,1029.65711361363,1032.79870589795,1035.94029818450,1039.08189047327,1042.22348276425,1045.36507505740,1048.50666735271,1051.64825965016,1054.78985194974,1057.93144425141,1061.07303655517,1064.21462886100,1067.35622116887,1070.49781347877,1073.63940579069,1076.78099810459,1079.92259042048,1083.06418273832,1086.20577505810,1089.34736737981,1092.48895970343,1095.63055202894,1098.77214435633,1101.91373668558,1105.05532901667,1108.19692134959,1111.33851368432,1114.48010602085,1117.62169835917,1120.76329069925,1123.90488304108,1127.04647538465,1130.18806772994,1133.32966007695,1136.47125242565,1139.61284477603,1142.75443712807,1145.89602948177,1149.03762183711,1152.17921419408,1155.32080655266,1158.46239891284,1161.60399127461,1164.74558363795,1167.88717600285,1171.02876836930,1174.17036073729,1177.31195310680,1180.45354547783,1183.59513785035,1186.73673022437,1189.87832259985,1193.01991497681,1196.16150735521,1199.30309973506,1202.44469211634,1205.58628449904,1208.72787688315,1211.86946926865,1215.01106165554,1218.15265404380,1221.29424643343,1224.43583882442,1227.57743121675,1230.71902361041,1233.86061600540,1237.00220840170,1240.14380079930,1243.28539319820,1246.42698559838,1249.56857799983,1252.71017040255,1255.85176280653,1258.99335521175,1262.13494761821,1265.27654002589,1268.41813243479,1271.55972484490,1274.70131725622,1277.84290966872,1280.98450208240,1284.12609449726,1287.26768691329,1290.40927933047,1293.55087174880,1296.69246416827,1299.83405658887,1302.97564901059,1306.11724143343,1309.25883385738,1312.40042628243,1315.54201870857,1318.68361113579,1321.82520356409,1324.96679599345,1328.10838842388,1331.24998085536,1334.39157328789,1337.53316572145,1340.67475815605,1343.81635059167,1346.95794302831,1350.09953546595,1353.24112790460,1356.38272034425,1359.52431278488,1362.66590522650,1365.80749766909,1368.94909011265,1372.09068255717,1375.23227500264,1378.37386744907,1381.51545989644,1384.65705234474,1387.79864479397,1390.94023724413,1394.08182969520,1397.22342214718,1400.36501460007,1403.50660705385,1406.64819950853,1409.78979196410,1412.93138442054,1416.07297687786,1419.21456933605,1422.35616179510,1425.49775425501,1428.63934671578,1431.78093917738,1434.92253163983,1438.06412410312,1441.20571656723,1444.34730903217,1447.48890149792,1450.63049396449,1453.77208643187,1456.91367890005,1460.05527136903,1463.19686383880,1466.33845630936,1469.48004878071,1472.62164125283,1475.76323372572,1478.90482619938,1482.04641867380,1485.18801114898,1488.32960362492,1491.47119610160,1494.61278857903,1497.75438105719,1500.89597353609,1504.03756601572,1507.17915849608,1510.32075097715,1513.46234345894,1516.60393594145,1519.74552842466,1522.88712090857,1526.02871339318,1529.17030587849,1532.31189836449,1535.45349085117,1538.59508333853,1541.73667582657,1544.87826831529,1548.01986080467,1551.16145329472,1554.30304578543,1557.44463827680,1560.58623076882,1563.72782326149,1566.86941575480];
bessel1zeros = [3.83170597020751,7.01558666981562,10.1734681350627,13.3236919363142,16.4706300508776,19.6158585104682,22.7600843805928,25.9036720876184,29.0468285349169,32.1896799109744,35.3323075500839,38.4747662347716,41.6170942128145,44.7593189976528,47.9014608871855,51.0435351835715,54.1855536410613,57.3275254379010,60.4694578453475,63.6113566984812,66.7532267340985,69.8950718374958,73.0368952255738,76.1786995846415,79.3204871754763,82.4622599143736,85.6040194363502,88.7457671449263,91.8875042516950,95.0292318080447,98.1709507307908,101.312661823039,104.454365791283,107.596063259509,110.737754780899,113.879440847595,117.021121898892,120.162798328149,123.304470488636,126.446138698517,129.587803245104,132.729464388510,135.871122364789,139.012777388660,142.154429655859,145.296079345196,148.437726620342,151.579371631401,154.721014516286,157.862655401930,161.004294405362,164.145931634650,167.287567189744,170.429201163227,173.570833640976,176.712464702764,179.854094422788,182.995722870153,186.137350109296,189.278976200376,192.420601199626,195.562225159663,198.703848129777,201.845470156191,204.987091282292,208.128711548850,211.270330994208,214.411949654462,217.553567563624,220.695184753769,223.836801255172,226.978417096429,230.120032304579,233.261646905201,236.403260922514,239.544874379470,242.686487297829,245.828099698240,248.969711600310,252.111323022669,255.252933983028,258.394544498240,261.536154584344,264.677764256622,267.819373529635,270.960982417271,274.102590932781,277.244199088815,280.385806897456,283.527414370251,286.669021518243,289.810628351994,292.952234881614,296.093841116782,299.235447066774,302.377052740478,305.518658146416,308.660263292764,311.801868187371,314.943472837767,318.085077251190,321.226681434593,324.368285394658,327.509889137813,330.651492670239,333.793095997889,336.934699126488,340.076302061554,343.217904808401,346.359507372151,349.501109757741,352.642711969932,355.784314013319,358.925915892333,362.067517611253,365.209119174210,368.350720585196,371.492321848065,374.633922966544,377.775523944235,380.917124784621,384.058725491072,387.200326066848,390.341926515104,393.483526838895,396.625127041178,399.766727124817,402.908327092588,406.049926947180,409.191526691201,412.333126327177,415.474725857559,418.616325284726,421.757924610982,424.899523838567,428.041122969653,431.182722006349,434.324320950704,437.465919804707,440.607518570290,443.749117249332,446.890715843658,450.032314355042,453.173912785208,456.315511135835,459.457109408554,462.598707604951,465.740305726573,468.881903774921,472.023501751458,475.165099657610,478.306697494762,481.448295264266,484.589892967438,487.731490605558,490.873088179877,494.014685691610,497.156283141946,500.297880532039,503.439477863019,506.581075135985,509.722672352010,512.864269512139,516.005866617394,519.147463668772,522.289060667243,525.430657613758,528.572254509243,531.713851354602,534.855448150718,537.997044898455,541.138641598654,544.280238252139,547.421834859715,550.563431422166,553.705027940262,556.846624414753,559.988220846372,563.129817235838,566.271413583851,569.413009891099,572.554606158251,575.696202385965,578.837798574883,581.979394725632,585.120990838828,588.262586915072,591.404182954953,594.545778959048,597.687374927921,600.828970862124,603.970566762199,607.112162628675,610.253758462071,613.395354262895,616.536950031646,619.678545768810,622.820141474867,625.961737150284,629.103332795521,632.244928411027,635.386523997244,638.528119554603,641.669715083528,644.811310584436,647.952906057734,651.094501503820,654.236096923088,657.377692315922,660.519287682699,663.660883023789,666.802478339555,669.944073630353,673.085668896533,676.227264138439,679.368859356406,682.510454550766,685.652049721842,688.793644869954,691.935239995414,695.076835098530,698.218430179603,701.360025238929,704.501620276799,707.643215293499,710.784810289309,713.926405264506,717.068000219361,720.209595154139,723.351190069102,726.492784964507,729.634379840607,732.775974697650,735.917569535881,739.059164355538,742.200759156858,745.342353940074,748.483948705411,751.625543453096,754.767138183349,757.908732896385,761.050327592419,764.191922271660,767.333516934314,770.475111580584,773.616706210670,776.758300824768,779.899895423072,783.041490005771,786.183084573053,789.324679125101,792.466273662097,795.607868184219,798.749462691643,801.891057184541,805.032651663084,808.174246127438,811.315840577769,814.457435014239,817.599029437008,820.740623846233,823.882218242069,827.023812624668,830.165406994182,833.307001350756,836.448595694539,839.590190025673,842.731784344300,845.873378650558,849.014972944586,852.156567226519,855.298161496489,858.439755754629,861.581350001067,864.722944235932,867.864538459348,871.006132671440,874.147726872330,877.289321062138,880.430915240983,883.572509408982,886.714103566249,889.855697712900,892.997291849045,896.138885974795,899.280480090260,902.422074195546,905.563668290759,908.705262376005,911.846856451386,914.988450517003,918.130044572957,921.271638619347,924.413232656270,927.554826683822,930.696420702099,933.838014711193,936.979608711198,940.121202702205,943.262796684302,946.404390657580,949.545984622125,952.687578578025,955.829172525363,958.970766464225,962.112360394693,965.253954316849,968.395548230775,971.537142136550,974.678736034253,977.820329923961,980.961923805752,984.103517679701,987.245111545884,990.386705404374,993.528299255243,996.669893098565,999.811486934410,1002.95308076285,1006.09467458395,1009.23626839778,1012.37786220442,1015.51945600391,1018.66104979634,1021.80264358177,1024.94423736026,1028.08583113187,1031.22742489668,1034.36901865473,1037.51061240609,1040.65220615083,1043.79379988899,1046.93539362065,1050.07698734586,1053.21858106467,1056.36017477715,1059.50176848335,1062.64336218332,1065.78495587713,1068.92654956482,1072.06814324645,1075.20973692208,1078.35133059174,1081.49292425551,1084.63451791342,1087.77611156554,1090.91770521190,1094.05929885256,1097.20089248756,1100.34248611697,1103.48407974081,1106.62567335915,1109.76726697203,1112.90886057949,1116.05045418158,1119.19204777834,1122.33364136983,1125.47523495608,1128.61682853713,1131.75842211304,1134.90001568384,1138.04160924958,1141.18320281029,1144.32479636603,1147.46638991682,1150.60798346272,1153.74957700375,1156.89117053997,1160.03276407141,1163.17435759810,1166.31595112009,1169.45754463741,1172.59913815011,1175.74073165821,1178.88232516176,1182.02391866080,1185.16551215535,1188.30710564545,1191.44869913114,1194.59029261246,1197.73188608943,1200.87347956210,1204.01507303049,1207.15666649464,1210.29825995458,1213.43985341035,1216.58144686197,1219.72304030948,1222.86463375292,1226.00622719230,1229.14782062767,1232.28941405905,1235.43100748648,1238.57260090998,1241.71419432959,1244.85578774533,1247.99738115723,1251.13897456532,1254.28056796964,1257.42216137020,1260.56375476704,1263.70534816019,1266.84694154966,1269.98853493550,1273.13012831772,1276.27172169635,1279.41331507143,1282.55490844297,1285.69650181100,1288.83809517555,1291.97968853664,1295.12128189430,1298.26287524855,1301.40446859941,1304.54606194692,1307.68765529110,1310.82924863196,1313.97084196954,1317.11243530386,1320.25402863493,1323.39562196279,1326.53721528746,1329.67880860895,1332.82040192730,1335.96199524252,1339.10358855464,1342.24518186367,1345.38677516964,1348.52836847257,1351.66996177249,1354.81155506940,1357.95314836334,1361.09474165433,1364.23633494237,1367.37792822751,1370.51952150974,1373.66111478910,1376.80270806561,1379.94430133928,1383.08589461013,1386.22748787819,1389.36908114346,1392.51067440598,1395.65226766576,1398.79386092281,1401.93545417715,1405.07704742882,1408.21864067781,1411.36023392415,1414.50182716786,1417.64342040895,1420.78501364745,1423.92660688336,1427.06820011671,1430.20979334751,1433.35138657579,1436.49297980155,1439.63457302481,1442.77616624559,1445.91775946391,1449.05935267977,1452.20094589321,1455.34253910423,1458.48413231284,1461.62572551908,1464.76731872294,1467.90891192444,1471.05050512360,1474.19209832044,1477.33369151497,1480.47528470721,1483.61687789716,1486.75847108484,1489.90006427028,1493.04165745347,1496.18325063444,1499.32484381320,1502.46643698977,1505.60803016415,1508.74962333636,1511.89121650642,1515.03280967433,1518.17440284012,1521.31599600379,1524.45758916536,1527.59918232484,1530.74077548224,1533.88236863758,1537.02396179087,1540.16555494212,1543.30714809135,1546.44874123856,1549.59033438377,1552.73192752698,1555.87352066823,1559.01511380750,1562.15670694483,1565.29830008021,1568.43989321366];

for k = 1:L
    rho = Rho(k);
    fnReal(k) = PhiReal(rho);
    fnImag(k) = PhiImag(rho);
    for n = 1:N
        an = 3*n-2;
        J(k,n) = besselj(0,an*rho);
    end
end

% solve lineary system of equations
Freal = fnReal';
Creal = J\Freal;
appFreal = J*Creal;

Fimag = fnImag';
Cimag = J\Fimag;
appFimag = J*Cimag;

MSEreal = mean((appFreal-Freal).^2);
MSEimag = mean((appFimag-Fimag).^2);

F = Freal + 1i*Fimag;
appF = appFreal + 1i* appFimag;
MSE = mean((abs(appF)-abs(F)).^2);

disp(['MSE real: ' num2str(MSEreal) ', MSE imag: ' num2str(MSEimag) ', MSE: ' num2str(MSE)]);


string = 'Real';
X1 = Rho;
YMatrix1 = Freal;
YMatrix2 = appFreal;

% string = 'Imaginary';
% X1 = Rho;
% YMatrix1 = Fimag;
% YMatrix2 = appFimag;

figure1 = figure;
% Create axes
axes1 = axes('Parent',figure1,...
    'Position',[0.13 0.522388059701492 0.775 0.402611940298507]);
hold(axes1,'on');

% Create multiple lines using matrix input to plot
plot1 = plot(X1,YMatrix1); hold on; plot2 = plot(X1, YMatrix2);
set(plot1(1),'DisplayName','original function','Marker','*',...
    'LineStyle','none');
set(plot2,'DisplayName','approximation','Color',[1 0 0]);

if strcmp(string,'Imaginary')
    % Create xlabel
    xlabel('Normalized \rho');
end

% Create title
title([string ' part of f(\rho,\theta)']);

% Create ylabel
ylabel([string ' value of f (\rho,\theta)']);

box(axes1,'on');
grid(axes1,'on');
% Set the remaining axes properties
set(axes1,'FontName','Times New Roman','FontSize',16);
% Create legend
if strcmp(string,'Real')
    legend1 = legend(axes1,'show');
    set(legend1,...
        'Position',[0.14575779550399 0.834879406307979 0.107686729514141 0.075139146567718],...
        'FontSize',16);
end